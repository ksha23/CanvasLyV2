{"version":3,"file":"jwtStrategy.js","names":["_passport","_interopRequireDefault","require","_passportJwt","_User","obj","__esModule","default","isProduction","process","env","NODE_ENV","secretOrKey","JWT_SECRET_PROD","JWT_SECRET_DEV","cookieExtractor","req","token","cookies","jwtLogin","JwtStrategy","jwtFromRequest","ExtractJwt","fromExtractors","fromAuthHeaderAsBearerToken","payload","done","user","User","findById","id","err","passport","use"],"sources":["../../src/services/jwtStrategy.js"],"sourcesContent":["import passport from 'passport';\nimport { Strategy as JwtStrategy, ExtractJwt } from 'passport-jwt';\n\nimport User from '../models/User';\n\nconst isProduction = process.env.NODE_ENV === 'production';\nconst secretOrKey = isProduction ? process.env.JWT_SECRET_PROD : process.env.JWT_SECRET_DEV;\n\nvar cookieExtractor = (req) => {\n  var token = null;\n  if (req && req.cookies) {\n    token = req.cookies['x-auth-cookie'];\n  }\n  return token;\n};\n\n// JWT strategy\nconst jwtLogin = new JwtStrategy(\n  {\n    jwtFromRequest: ExtractJwt.fromExtractors([cookieExtractor, ExtractJwt.fromAuthHeaderAsBearerToken()]),\n    secretOrKey,\n  },\n  async (payload, done) => {\n    try {\n      const user = await User.findById(payload.id);\n\n      if (user) {\n        // remove refresh token from user object\n        // user.refreshToken = undefined;\n        done(null, user);\n      } else {\n        done(null, false);\n      }\n    } catch (err) {\n      done(err, false);\n    }\n  },\n);\n\npassport.use(jwtLogin);\n"],"mappings":";;AAAA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AAEA,IAAAE,KAAA,GAAAH,sBAAA,CAAAC,OAAA;AAAkC,SAAAD,uBAAAI,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAElC,MAAMG,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY;AAC1D,MAAMC,WAAW,GAAGJ,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACG,eAAe,GAAGJ,OAAO,CAACC,GAAG,CAACI,cAAc;AAE3F,IAAIC,eAAe,GAAIC,GAAG,IAAK;EAC7B,IAAIC,KAAK,GAAG,IAAI;EAChB,IAAID,GAAG,IAAIA,GAAG,CAACE,OAAO,EAAE;IACtBD,KAAK,GAAGD,GAAG,CAACE,OAAO,CAAC,eAAe,CAAC;EACtC;EACA,OAAOD,KAAK;AACd,CAAC;;AAED;AACA,MAAME,QAAQ,GAAG,IAAIC,qBAAW,CAC9B;EACEC,cAAc,EAAEC,uBAAU,CAACC,cAAc,CAAC,CAACR,eAAe,EAAEO,uBAAU,CAACE,2BAA2B,CAAC,CAAC,CAAC,CAAC;EACtGZ;AACF,CAAC,EACD,OAAOa,OAAO,EAAEC,IAAI,KAAK;EACvB,IAAI;IACF,MAAMC,IAAI,GAAG,MAAMC,aAAI,CAACC,QAAQ,CAACJ,OAAO,CAACK,EAAE,CAAC;IAE5C,IAAIH,IAAI,EAAE;MACR;MACA;MACAD,IAAI,CAAC,IAAI,EAAEC,IAAI,CAAC;IAClB,CAAC,MAAM;MACLD,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC;IACnB;EACF,CAAC,CAAC,OAAOK,GAAG,EAAE;IACZL,IAAI,CAACK,GAAG,EAAE,KAAK,CAAC;EAClB;AACF,CACF,CAAC;AAEDC,iBAAQ,CAACC,GAAG,CAACd,QAAQ,CAAC"}