{"version":3,"file":"googleAuth.js","names":["_express","require","_passport","_interopRequireDefault","obj","__esModule","default","router","Router","get","passport","authenticate","scope","prompt","accessType","clientUrl","process","env","NODE_ENV","CLIENT_URL_PROD","CLIENT_URL_DEV","failureRedirect","session","req","res","token","user","generateJWT","cookie","maxAge","httpOnly","secure","redirect","logout","clearCookie","send","_default","exports"],"sources":["../../src/routes/googleAuth.js"],"sourcesContent":["import { Router } from 'express';\nimport passport from 'passport';\n// const useragent = require('express-useragent');\n\nconst router = Router();\n\nrouter.get(\n  '/google',\n  passport.authenticate('google', {\n    scope: ['profile', 'email', 'https://www.googleapis.com/auth/calendar'],\n    prompt: 'select_account',\n    accessType: 'offline',\n  }),\n);\n\nconst clientUrl = process.env.NODE_ENV === 'production' ? process.env.CLIENT_URL_PROD : process.env.CLIENT_URL_DEV;\n\nrouter.get(\n  '/google/callback',\n  passport.authenticate('google', {\n    failureRedirect: '/',\n    session: false,\n  }),\n  (req, res) => {\n    const token = req.user.generateJWT();\n\n    res.cookie('x-auth-cookie', token, {\n      maxAge: 1000 * 60 * 60 * 12, // 12 hours\n      httpOnly: true, // very important\n      secure: process.env.NODE_ENV === 'production',\n    });\n    res.redirect(clientUrl);\n  },\n);\n\nrouter.get('/logout', (req, res) => {\n  req.logout(); // this is a passport function\n  res.clearCookie('x-auth-cookie'); // very important to clear the cookie\n  res.send(false);\n});\n\nexport default router;\n"],"mappings":";;;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAC,sBAAA,CAAAF,OAAA;AAAgC,SAAAE,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAChC;;AAEA,MAAMG,MAAM,GAAG,IAAAC,eAAM,EAAC,CAAC;AAEvBD,MAAM,CAACE,GAAG,CACR,SAAS,EACTC,iBAAQ,CAACC,YAAY,CAAC,QAAQ,EAAE;EAC9BC,KAAK,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,0CAA0C,CAAC;EACvEC,MAAM,EAAE,gBAAgB;EACxBC,UAAU,EAAE;AACd,CAAC,CACH,CAAC;AAED,MAAMC,SAAS,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,GAAGF,OAAO,CAACC,GAAG,CAACE,eAAe,GAAGH,OAAO,CAACC,GAAG,CAACG,cAAc;AAElHb,MAAM,CAACE,GAAG,CACR,kBAAkB,EAClBC,iBAAQ,CAACC,YAAY,CAAC,QAAQ,EAAE;EAC9BU,eAAe,EAAE,GAAG;EACpBC,OAAO,EAAE;AACX,CAAC,CAAC,EACF,CAACC,GAAG,EAAEC,GAAG,KAAK;EACZ,MAAMC,KAAK,GAAGF,GAAG,CAACG,IAAI,CAACC,WAAW,CAAC,CAAC;EAEpCH,GAAG,CAACI,MAAM,CAAC,eAAe,EAAEH,KAAK,EAAE;IACjCI,MAAM,EAAE,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;IAAE;IAC7BC,QAAQ,EAAE,IAAI;IAAE;IAChBC,MAAM,EAAEf,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK;EACnC,CAAC,CAAC;EACFM,GAAG,CAACQ,QAAQ,CAACjB,SAAS,CAAC;AACzB,CACF,CAAC;AAEDR,MAAM,CAACE,GAAG,CAAC,SAAS,EAAE,CAACc,GAAG,EAAEC,GAAG,KAAK;EAClCD,GAAG,CAACU,MAAM,CAAC,CAAC,CAAC,CAAC;EACdT,GAAG,CAACU,WAAW,CAAC,eAAe,CAAC,CAAC,CAAC;EAClCV,GAAG,CAACW,IAAI,CAAC,KAAK,CAAC;AACjB,CAAC,CAAC;AAAC,IAAAC,QAAA,GAAAC,OAAA,CAAA/B,OAAA,GAEYC,MAAM"}