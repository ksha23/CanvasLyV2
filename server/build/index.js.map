{"version":3,"file":"index.js","names":["require","_express","_interopRequireDefault","_mongoose","_https","_fs","_path","_passport","_routes","_cors","_cookieParser","obj","__esModule","default","app","express","use","json","urlencoded","extended","cookieParser","passport","initialize","cors","origin","credentials","methods","isProduction","process","env","NODE_ENV","dbConnection","MONGO_URI_PROD","MONGO_URI_DEV","mongoose","connect","useNewUrlParser","useCreateIndex","useUnifiedTopology","useFindAndModify","then","console","log","catch","err","routes","IMAGES_FOLDER_PATH","fs","existsSync","join","__dirname","mkdirSync","static","get","req","res","sendFile","resolve","port","PORT","listen","httpsOptions","key","readFileSync","cert","server","https","createServer"],"sources":["../src/index.js"],"sourcesContent":["import 'dotenv/config';\nimport express from 'express';\nimport mongoose from 'mongoose';\nimport https from 'https';\nimport { readFileSync } from 'fs';\nimport { resolve, join } from 'path';\nimport passport from 'passport';\nimport routes from './routes';\nimport cors from 'cors';\nimport cookieParser from 'cookie-parser';\n\nconst app = express();\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(cookieParser());\n\napp.use(passport.initialize());\nrequire('./services/jwtStrategy');\nrequire('./services/googleStrategy');\nrequire('./services/googleAuthCodeStrategy');\n\napp.use(\n  cors({\n    origin: `http://localhost:3000`,\n    credentials: true,\n    methods: ['GET', 'POST', 'PUT', 'DELETE'],\n  }),\n);\n\nconst isProduction = process.env.NODE_ENV === 'production';\n\n// DB Config\nconst dbConnection = isProduction ? process.env.MONGO_URI_PROD : process.env.MONGO_URI_DEV;\n\n// Connect to Mongo\nmongoose\n  .connect(dbConnection, {\n    useNewUrlParser: true,\n    useCreateIndex: true,\n    useUnifiedTopology: true,\n    useFindAndModify: false,\n  })\n  .then(() => {\n    console.log('MongoDB Connected...');\n  })\n  .catch((err) => console.log(err));\n\n// Use Routes\napp.use('/', routes);\n\n// Serve images\n// make /public/images folder if it doesnt exist\nconst IMAGES_FOLDER_PATH = '/public/images/';\nconst fs = require('fs');\nif (!fs.existsSync(join(__dirname, '../public'))) {\n  fs.mkdirSync(join(__dirname, '../public'));\n}\nif (!fs.existsSync(join(__dirname, '../public/images'))) {\n  fs.mkdirSync(join(__dirname, '../public/images'));\n}\napp.use('/public/images', express.static(join(__dirname, '../public/images')));\n\n// Serve static assets if in production\nif (isProduction) {\n  // Set static folder\n  app.use(express.static(join(__dirname, '../../client/build')));\n  app.get('*', (req, res) => {\n    // index is in /server/src so 2 folders up\n    res.sendFile(resolve(__dirname, '../..', 'client', 'build', 'index.html'));\n  });\n\n  const port = process.env.PORT || 80;\n  app.listen(port, () => console.log(`Server started on port ${port}`));\n} else {\n  const port = process.env.PORT || 5000;\n\n  const httpsOptions = {\n    key: readFileSync(resolve(__dirname, '../security/cert.key')),\n    cert: readFileSync(resolve(__dirname, '../security/cert.pem')),\n  };\n\n  const server = https.createServer(httpsOptions, app).listen(port, () => {\n    console.log('https server running at ' + port);\n  });\n}\n"],"mappings":"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"}